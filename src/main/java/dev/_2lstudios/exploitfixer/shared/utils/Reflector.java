package dev._2lstudios.exploitfixer.shared.utils;

import com.mojang.authlib.GameProfile;

import org.bukkit.Bukkit;
import org.bukkit.inventory.meta.SkullMeta;

import java.lang.reflect.Field;

public class Reflector {
    private static String version;

    private static Field PROFILE_FIELD;
    private static Field PROPERTIES_FIELD;

    static {
        try {
            String[] split = Bukkit.getServer().getClass().getPackage().getName().split("\\.");
            version = split[split.length - 1];

            Class<?> CRAFT_META_SKULL = getCraftBukkitClass("inventory.CraftMetaSkull");

            PROFILE_FIELD = CRAFT_META_SKULL.getDeclaredField("profile");
            PROFILE_FIELD.setAccessible(true);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private static Class<?> getCraftBukkitClass(String name) throws ClassNotFoundException {
        return Class.forName(String.format(
                "org.bukkit.craftbukkit.%s.%s",
                version,
                name
        ));
    }

    public static GameProfile getGameProfile(SkullMeta skullMeta) {
        try {
            return (GameProfile) PROFILE_FIELD.get(skullMeta);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
            return null;
        }
    }

    public static void setGameProfile(SkullMeta skullMeta, GameProfile profile) {
        try {
            PROFILE_FIELD.set(skullMeta, profile);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
    }
}
